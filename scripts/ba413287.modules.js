angular.module("mongolabResourceHttp",[]).factory("$mongolabResourceHttp",["MONGOLAB_CONFIG","$http",function(a,b){function c(c){var d=angular.extend({BASE_URL:"https://api.mongolab.com/api/1/databases/"},a),e=d.BASE_URL+d.DB_NAME,f=e+"/collections/"+c,g={apiKey:d.API_KEY},h=function(a){return new l(a)},i=function(a){for(var b=[],c=0;c<a.length;c++)b.push(new l(a[c]));return b},j=function(a,b,c,d){return a.then(function(a){var c=d(a.data);return(b||angular.noop)(c,a.status,a.headers,a.config),c},function(a){return(c||angular.noop)(void 0,a.status,a.headers,a.config),void 0})},k=function(a){return angular.isObject(a)&&Object.keys(a).length?{q:JSON.stringify(a)}:{}},l=function(a){angular.extend(this,a)};return l.query=function(a,c,d,e){var h=function(a){var b={sort:"s",limit:"l",fields:"f",skip:"sk"},c={};return a&&!angular.equals(a,{})&&angular.forEach(b,function(b,d){angular.isDefined(a[d])&&(c[b]=angular.isObject(a[d])?JSON.stringify(a[d]):a[d])}),c};angular.isFunction(c)&&(e=d,d=c,c={});var l=angular.extend({},g,k(a),h(c)),m=b.get(f,{params:l});return j(m,d,e,i)},l.all=function(a,b,c){return angular.isFunction(a)&&(c=b,b=a,a={}),l.query({},a,b,c)},l.count=function(a,c,d){var e=b.get(f,{params:angular.extend({},g,k(a),{c:!0})});return j(e,c,d,function(a){return a})},l.distinct=function(a,d,f,h){var i=b.post(e+"/runCommand",angular.extend({},d||{},{distinct:c,key:a}),{params:g});return j(i,f,h,function(a){return a.values})},l.getById=function(a,c,d){var e=b.get(f+"/"+a,{params:g});return j(e,c,d,h)},l.getByObjectIds=function(a,b,c){var d=[];return angular.forEach(a,function(a){d.push({$oid:a})}),l.query({_id:{$in:d}},b,c)},l.find=function(a){if(a.length<3)return[];var b={$or:[{first:{$regex:a,$options:"i"}},{last:{$regex:a,$options:"i"}}]};return l.query(b,function(a){return _.map(a,function(a){a.fullName=a.first+" "+a.last}),a})},l.prototype.$id=function(){return this._id&&this._id.$oid?this._id.$oid:this._id?this._id:void 0},l.prototype.$save=function(a,c){var d=b.post(f,this,{params:g});return j(d,a,c,h)},l.prototype.$update=function(a,c){var d=b.put(f+"/"+this.$id(),angular.extend({},this,{_id:void 0}),{params:g});return j(d,a,c,h)},l.prototype.$remove=function(a,c){var d=b["delete"](f+"/"+this.$id(),{params:g});return j(d,a,c,h)},l.prototype.$saveOrUpdate=function(a,b,c,d){return this.$id()?this.$update(b,d):this.$save(a,c)},l}return c}]);